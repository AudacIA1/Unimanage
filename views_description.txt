# Descripción de las Vistas del Proyecto UniManage

Este documento detalla todas las vistas de la aplicación, organizadas por cada app de Django.

---

## 1. App: `accounts`

Maneja el registro de nuevos usuarios en el sistema.

- **`register(request)`**
  - **Propósito:** Gestiona el registro de nuevos usuarios.
  - **Funcionalidad:**
    - Si la solicitud es `POST`, valida el formulario de registro (`UserRegisterForm`).
    - Si el formulario es válido, guarda el nuevo usuario, muestra un mensaje de éxito y redirige a la página de inicio de sesión.
    - Si la solicitud es `GET`, muestra un formulario de registro en blanco.
  - **Ruta:** `accounts/register.html`

---

## 2. App: `assets`

Gestiona todo lo relacionado con los activos: su creación, visualización, edición, eliminación y las categorías a las que pertenecen. También incluye vistas de autocompletado para mejorar la experiencia en los formularios.

- **`asset_list(request)`**
  - **Propósito:** Muestra una lista de todos los activos con opciones de filtrado.
  - **Funcionalidad:**
    - Permite filtrar los activos por nombre, categoría, ubicación y estado.
    - Calcula y muestra métricas clave como el total de activos, disponibles, en uso y en mantenimiento.
  - **Ruta:** `assets/asset_list.html`

- **`asset_create(request)`**
  - **Propósito:** Permite la creación de un nuevo activo.
  - **Funcionalidad:**
    - Muestra un formulario (`AssetForm`) para ingresar los datos del nuevo activo.
    - Procesa el formulario y, si es válido, guarda el nuevo activo y redirige a la lista de activos.
  - **Ruta:** `assets/asset_form.html`

- **`asset_edit(request, pk)`**
  - **Propósito:** Permite editar un activo existente.
  - **Funcionalidad:**
    - Muestra un formulario (`AssetForm`) pre-rellenado con los datos del activo seleccionado.
    - Guarda los cambios y redirige a la lista de activos.
  - **Ruta:** `assets/asset_form.html`

- **`asset_delete(request, pk)`**
  - **Propósito:** Permite eliminar un activo.
  - **Funcionalidad:**
    - Muestra una página de confirmación antes de eliminar el activo.
    - Si se confirma, elimina el activo y redirige a la lista.
  - **Ruta:** `assets/asset_confirm_delete.html`

- **`asset_category_create_popup(request)`**
  - **Propósito:** Permite crear una nueva categoría de activo desde una ventana emergente (modal).
  - **Funcionalidad:**
    - Se utiliza para añadir categorías dinámicamente sin recargar la página.
    - Devuelve una respuesta `JSON` con los datos de la nueva categoría para ser añadida a un selector en el formulario principal.

- **`CategoryAutocomplete` (Class-Based View)**
  - **Propósito:** Proporciona la funcionalidad de autocompletado para el campo de selección de categorías.
  - **Funcionalidad:**
    - Utiliza `django-autocomplete-light` para buscar y devolver categorías que coincidan con la consulta del usuario.

- **`AssetAutocomplete` (Class-Based View)**
  - **Propósito:** Proporciona autocompletado para la selección de activos disponibles.
  - **Funcionalidad:**
    - Filtra los activos con estado "Disponible" y los devuelve para formularios de autocompletado, como en la creación de préstamos.

---

## 3. App: `chatbot`

Contiene la lógica del chatbot, que procesa el lenguaje natural para responder preguntas y ejecutar acciones.

- **`chatbot_api(request)`**
  - **Propósito:** Es el endpoint principal de la API del chatbot.
  - **Funcionalidad:**
    - Recibe mensajes de los usuarios en formato `JSON`.
    - Utiliza modelos de `spaCy` para la **clasificación de intenciones** y el **reconocimiento de entidades**.
    - **Gestión de conversación multi-paso:** Mantiene el estado de la conversación para tareas complejas como la creación de una solicitud de mantenimiento.
    - **Lógica de un solo paso:** Responde a preguntas directas como "listar activos disponibles" o "contar activos en uso".
    - **Funciones de herramientas:** Llama a funciones auxiliares (`tools.py`) para interactuar con la base de datos (ej. `get_available_assets`, `create_maintenance_request`).
    - **Fallback:** Proporciona una respuesta por defecto si no entiende la pregunta.

---

## 4. App: `dashboard`

Muestra la página de inicio de la aplicación con un resumen visual de los datos más importantes.

- **`dashboard(request)`**
  - **Propósito:** Muestra el panel de control principal.
  - **Funcionalidad:**
    - Recopila y muestra métricas generales: total de activos, activos por estado, etc.
    - Muestra la distribución de activos por categoría con barras de progreso.
    - Presenta los últimos movimientos (10 últimos préstamos y mantenimientos).
    - Prepara datos para gráficos (distribución de estados y activos por categoría) que se renderizan en el frontend.
  - **Ruta:** `dashboard.html`

---

## 5. App: `loans`

Gestiona el ciclo de vida de los préstamos de activos.

- **`loan_list(request)`**
  - **Propósito:** Muestra una lista de todos los préstamos con filtros.
  - **Funcionalidad:**
    - Permite filtrar los préstamos por estado ("Activo" o "Devuelto").
    - Muestra métricas como el total de préstamos, activos y devueltos.
  - **Ruta:** `loans/loan_list.html`

- **`loan_create(request)`**
  - **Propósito:** Permite registrar un nuevo préstamo.
  - **Funcionalidad:**
    - Muestra un formulario (`LoanForm`) para crear un nuevo préstamo.
    - Al guardar, actualiza el estado del activo a "En uso".
  - **Ruta:** `loans/loan_form.html`

- **`loan_edit(request, pk)`**
  - **Propósito:** Permite editar un préstamo existente.
  - **Funcionalidad:**
    - Muestra un formulario (`LoanForm`) pre-rellenado.
    - Permite cambiar el estado del préstamo (ej. de "Activo" a "Devuelto"), lo que a su vez actualiza el estado del activo correspondiente.
  - **Ruta:** `loans/loan_form.html`

- **`loan_delete(request, pk)`**
  - **Propósito:** Permite eliminar un registro de préstamo.
  - **Funcionalidad:**
    - Muestra una página de confirmación antes de la eliminación.
  - **Ruta:** `loans/loan_confirm_delete.html`

---

## 6. App: `maintenance`

Gestiona las solicitudes y el seguimiento de las tareas de mantenimiento de los activos.

- **`maintenance_list(request)`**
  - **Propósito:** Muestra una lista de todas las tareas de mantenimiento.
  - **Funcionalidad:**
    - Permite filtrar las tareas por estado ("Pendiente", "En proceso", "Finalizado").
    - Muestra métricas sobre el estado de las tareas.
  - **Ruta:** `maintenance/maintenance_list.html`

- **`maintenance_create(request)`**
  - **Propósito:** Permite crear una nueva solicitud de mantenimiento.
  - **Funcionalidad:**
    - Muestra un formulario (`MaintenanceForm`) para registrar una nueva tarea.
    - Al crearla, actualiza el estado del activo a "En mantenimiento".
  - **Ruta:** `maintenance/maintenance_form.html`

- **`maintenance_edit(request, pk)`**
  - **Propósito:** Permite editar una tarea de mantenimiento.
  - **Funcionalidad:**
    - Muestra un formulario (`MaintenanceForm`) pre-rellenado.
    - Permite actualizar el estado de la tarea, y si se marca como "Finalizado", el activo vuelve a estar "Disponible".
  - **Ruta:** `maintenance/maintenance_form.html`

- **`maintenance_delete(request, pk)`**
  - **Propósito:** Permite eliminar una tarea de mantenimiento.
  - **Funcionalidad:**
    - Muestra una página de confirmación antes de la eliminación.
  - **Ruta:** `maintenance/maintenance_confirm_delete.html`

---

## 7. App: `reports`

Destinada a la generación y visualización de informes.

- **`report_list(request)`**
  - **Propósito:** Muestra la página principal de la sección de informes.
  - **Funcionalidad:**
    - Actualmente, solo renderiza la plantilla base de informes. La lógica de generación de informes aún no está implementada.
  - **Ruta:** `reports/report_list.html`

---

## 8. App: `usermanagement`

Gestiona los usuarios del sistema (CRUD), accesible solo para superusuarios.

- **`UserListView` (Class-Based View)**
  - **Propósito:** Muestra una lista de todos los usuarios registrados.
  - **Acceso:** Solo superusuarios.
  - **Ruta:** `usermanagement/user_list.html`

- **`UserCreateView` (Class-Based View)**
  - **Propósito:** Permite a un superusuario crear un nuevo usuario.
  - **Acceso:** Solo superusuarios.
  - **Ruta:** `usermanagement/user_form.html`

- **`UserUpdateView` (Class-Based View)**
  - **Propósito:** Permite a un superusuario editar los datos de un usuario existente.
  - **Acceso:** Solo superusuarios.
  - **Ruta:** `usermanagement/user_form.html`

- **`UserDeleteView` (Class-Based View)**
  - **Propósito:** Permite a un superusuario eliminar un usuario.
  - **Acceso:** Solo superusuarios.
  - **Ruta:** `usermanagement/user_confirm_delete.html`
